<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mk.taskfactory.biz.mapper.RoomSaleConfigMapper">

	<resultMap id="roomSaleConfig" type="com.mk.taskfactory.model.TRoomSaleConfig">
	    <result property="id" column="id" />
	    <result property="hotelId" column="hotelId" />
	    <result property="roomId" column="roomId" />
        <result property="roomTypeId" column="roomTypeId" />
        <result property="startTime" column="startTime" />
        <result property="endTime" column="endTime" />
        <result property="startDate" column="startDate" />
        <result property="endDate" column="endDate" />
        <result property="saleValue" column="saleValue" />
        <result property="num" column="num" />
        <result property="type" column="type"/>
        <result property="saleName" column="saleName" />

        <result property="saleRoomTypeId" column="saleRoomTypeId" />
        <result property="settleValue" column="settleValue" />
        <result property="settleType" column="settleType" />
        <result property="valid" column="valid" />
	</resultMap>

    <sql id="Base_Column_List" >
        id, hotelId, roomId, roomTypeId, startTime, endTime, startDate, endDate, saleValue,num,type,saleName,
        saleRoomTypeId,settleValue,settleType,valid
    </sql>

    <sql id="Base_Query_List" >
        <where>
              1 = 1
            <if test="id != null">
                AND id = #{id}
            </if>
            <if test="hotelId != null">
                AND hotelId = #{hotelId}
            </if>
            <if test="roomId != null">
                AND roomId = #{roomId}
            </if>
            <if test="roomTypeId != null">
                AND roomTypeId = #{roomTypeId}
            </if>
            <if test="startTime != null">
                AND startTime = #{startTime}
            </if>
            <if test="endTime != null">
                AND endTime = #{endTime}
            </if>
            <if test="startDate != null">
                AND startDate = #{startDate}
            </if>
            <if test="endDate != null">
                AND endDate = #{endDate}
            </if>
            <if test="type != null">
                AND type = #{type}
            </if>
            <if test="saleName != null">
                AND saleName = #{saleName}
            </if>
            <if test="matchDate != null">
                AND startDate > #{matchDate}
            </if>
            <if test="matchDate != null">
                <![CDATA[  AND endDate < #{matchDate} ]]>
            </if>
            <if test="valid != null">
                AND valid > #{valid}
            </if>
            <if test="saleRoomTypeId != null">
                AND saleRoomTypeId = #{saleRoomTypeId}
            </if>
            <if test="settleValue != null">
                AND settleValue = #{settleValue}
            </if>
            <if test="settleType != null">
                AND settleType = #{settleType}
            </if>
            <if test="valid != null">
                AND valid = #{valid}
            </if>
        </where>
    </sql>

    <select id="queryRoomSaleConfigByParams" resultMap="roomSaleConfig" parameterType="com.mk.taskfactory.api.dtos.TRoomSaleConfigDto">
        SELECT
        <include refid="Base_Column_List"/>
         FROM  t_room_sale_config
        <include refid="Base_Query_List"/>
    </select>
    <select id="queryRoomSaleConfigByValid" resultMap="roomSaleConfig" parameterType="String">
        SELECT
        <include refid="Base_Column_List"/>
        FROM  t_room_sale_config
        where   valid = #{valid}
    </select>


    <insert id="saveRoomSaleConfig"  parameterType="com.mk.taskfactory.api.dtos.TRoomSaleConfigDto" >
        INSERT INTO t_room_sale_config
        ( hotelId, roomId, roomTypeId, startTime, endTime, startDate, endDate, saleValue,num,type,saleName)
         VALUE
         (
            #{hotelId}, #{roomId},#{roomTypeId}, #{startTime}, #{endTime},
            #{startDate}, #{endDate}, #{saleValue},#{num},#{type},#{saleName}
            )
    </insert>


    <delete id="deleteRoomSaleConfig" parameterType="Integer">
         delete from t_room_sale_config where id = #{id}
    </delete>

    <update id="updateRoomSaleConfig" parameterType="com.mk.taskfactory.api.dtos.TRoomSaleConfigDto" >
        update t_room_sale_config
        set
         hotelId = #{hotelId},
         roomId = #{roomId},
         roomTypeId =  #{roomTypeId},
         startTime =  #{startTime},
         endTime  = #{endTime},
         startDate =  #{startDate},
         endDate =  #{endDate},
         saleValue  = #{saleValue},
         num  = #{num},
         type =  #{type}
         WHERE  id= #{id}
    </update>

    <update id="updateRoomSaleConfigValid" parameterType="java.util.Map" >
        update t_room_sale_config
        set
        valid =  #{valid}
        WHERE  id= #{id}
    </update>
</mapper>
